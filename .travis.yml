language: python

env:
  global:
    - REPO_DIR=dlib
    - BUILD_COMMIT=v19.21
    - CIBUILDWHEEL_VERSION=1.5.0
    - CIBW_BEFORE_BUILD="pip install cmake"
    - CIBW_SKIP="cp27-* cp35-* pp* *-win32 *i686"
    - TWINE_USERNAME=__token__
    - secure: "iPVbbP+XiufLNJNnt+byMWACq/Go6wwzp2ug8OQolhAAQwaNZkrwRiqxm+e3Z/i220oYda6Fx6X8bQiL5VikQ3TiRfidn/2EXv6owN+SBErGDPU5c39/Up9cIDIJRnvMCFIP9QRLw/OQ8Nki9wJVY5tS6IvExzZPnRwZP7N0xNq9oNQlqk9bKiP2F8Xf0QQ3gjeZC8tRVkZXT+0TGImnP8Krc18tSJGsX/dTFeOHXi6Q4kF3LtXsW12AYXdnfStyOtYrlzNeHOU//MnlWWN89le2XoSX3G1MCCGHPS1x0me1yFQwLVK+aLKUWGX/HryT/ZlyhT/WEaD9d/p7Cu1mrQnB1rpmG+BtJtnCS8kGESdykqHgKH24qIcrQXNqU4EZcm16larrbUV5WC7OEhGBLhLgx0DxbptZED43mP/aOqG/QVza4y6Edf56vLpKBOWTCZABLTP1ROdCowGL1Rma40GlrYJUjb8lcqEHR0qPvj0BY6wdBrhYWemltiKeqrc2KcA/vI7DwSJwIDK2bSdMJAGYKwzx8jVEvAAH6zHhXcnu7cHrIAR+7849EydD1n478Nt9QPNS6IBWcWIdGPM2FQsJLdt/P3KbmC8093EuS6z1m0W5rK9fha2NC/FEWGA7UYQh3npAFhwrw4AWT9IZJUzhCI7LSbPDlgT8sB/xyOg="

jobs:
  include:
    - name: Linux | x86_64 | Python 3.6
      services: docker
      env:
        - CIBW_BUILD=cp36-*
    - name: Linux | x86_64 | Python 3.7
      services: docker
      env:
        - CIBW_BUILD=cp37-*
    - name: Linux | x86_64 | Python 3.8
      services: docker
      env:
        - CIBW_BUILD=cp38-*
    - name: macOS | x86_64 | Python 3.6
      os: osx
      language: shell
      env:
        - CIBW_BUILD=cp36-*
    - name: macOS | x86_64 | Python 3.7
      os: osx
      language: shell
      env:
        - CIBW_BUILD=cp37-*
    - name: macOS | x86_64 | Python 3.8
      os: osx
      language: shell
      env:
        - CIBW_BUILD=cp38-*
    - name: Windows | x86_64 | Python 3.6
      os: windows
      language: shell
      before_install:
        - choco install python --version 3.8.0
        - export PATH="/c/Python38:/c/Python38/Scripts:$PATH"
        - ln -s /c/Python38/python.exe /c/Python38/python3.exe
      env:
        - CIBW_BUILD=cp36-*
    - name: Windows | x86_64 | Python 3.7
      os: windows
      language: shell
      before_install:
        - choco install python --version 3.8.0
        - export PATH="/c/Python38:/c/Python38/Scripts:$PATH"
        - ln -s /c/Python38/python.exe /c/Python38/python3.exe
      env:
        - CIBW_BUILD=cp37-*
    - name: Windows | x86_64 | Python 3.8
      os: windows
      language: shell
      before_install:
        - choco install python --version 3.8.0
        - export PATH="/c/Python38:/c/Python38/Scripts:$PATH"
        - ln -s /c/Python38/python.exe /c/Python38/python3.exe
      env:
        - CIBW_BUILD=cp38-*

install:
  - source config.sh
  - pre_build
  - python3 -m pip install cibuildwheel==$CIBUILDWHEEL_VERSION

script:
  - python3 -m cibuildwheel $REPO_DIR --output-dir wheelhouse

deploy:
  - provider: script
    script: bash deploy.sh
    skip_cleanup: true
    on:
      branch: master
